{% extends "base.html" %}

{% block content %}
<h2 class="fw-bold mb-4">Access & Invitations</h2>

<div class="row">
    <div class="col-lg-4 mb-4">
        <div class="card shadow-sm border-0">
            <div class="card-body">
                <h5 class="fw-bold mb-3">Grant Access</h5>
                <form>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">User Email</label>
                        <input type="email" class="form-control" placeholder="friend@example.com">
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">Select Gate</label>
                        <select class="form-select">
                            {% for device in current_user.owned_devices %}
                            <option value="{{ device.id }}">{{ device.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button class="btn btn-primary w-100">Send Invitation</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0 fw-bold">Invitations Received</h5>
            </div>
            <div class="card-body p-0">
                {% set invites = Invitation.query.filter_by(invitee_email=current_user.email, status='pending').all() %}
                {% if invites %}
                    {% for invite in invites %}
                    <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                        <div>
                            <span class="fw-bold">{{ invite.inviter.username }}</span> invited you to <span class="text-primary">{{ invite.device.name }}</span>
                        </div>
                        <div>
                            <button class="btn btn-success btn-sm me-1">Accept</button>
                            <button class="btn btn-danger btn-sm">Deny</button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-5">
                        <p class="text-muted mb-0">No pending invitations.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}